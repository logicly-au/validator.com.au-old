#!/usr/bin/env bash
set -e # halt script on error

mkdir _site
chmod a+w Gemfile.lock _site
mkdir _source/.jekyll-cache
chmod a+w _source/.jekyll-cache
sudo chown -R 1000:1000 vendor
chmod -R a+w vendor

# Install dependencies
docker-compose run site bundle install

# Build and test _site
docker-compose run site rake test

docker run -v $(pwd)/_site:/app stratdat/html5validator

#node --version
#./node_modules/a11y/cli.js --help
#./node_modules/a11y/cli.js {_site/*.html,_site/**/*.html}
